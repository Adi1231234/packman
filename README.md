[![NPM Version][npm-image]][npm-url]
[![NPM Downloads][downloads-image]][downloads-url]

# @boco/packman

Bulk download, publish, and copy packages and their dependencies by using the command line.

Currently supports npm but future support for pypi and other package managers is planned.

## Getting Started

Install packman:

```bash
npm install @boco/packman -g
```

## Using the CLI

`packman` uses `commander` and is modular by design.
There are three layers of commands.

1. The first layer are named after the package managers: `npm`, `pypi`, etc.
2. The second layer are the names of the operations: `download`, `publish`, `copy`, etc.
3. The third and last layer are modes of operation: `package`, `package-lock`, etc.

We don't nest deeper than three layers.
Anything beyond that is an argument.
The primary arguments are typically unprefixed, whereas the rest are prefixed with `--`.
Check the usage info for the details.

You can append `--help` at any layer to see the relavent arguments and sub-commands.
So you can run:
* `packman --help`
* `packman command --help`
* `packman command sub-command --help`

## Working with `npm`

### Download packages

Download packages based on any of the following:

- the name [and version] of a package
- a local `package-lock.json` file
- the url to a `package-lock.json` file
- a local `package.json` file
- the url to a `package.json` file
- the results of an npm search by keyword

Packages can be downloaded from any npm repository.
* The default is https://registry.npmjs.org/.
* The registry can often be overriden by using the `--registry`, `--source`, or `--target` arguments, depending on the command. Check the command's arguments to be sure.

The downloaded packages will be stored by default in a `tarballs` subdirectory of the current directory.
* The subdirectory will be created if necessary.
* You can specify a different subdirectory by using the `--directory` argument.

#### package name [and version]

##### by name:

```base
packman npm download package lodash
```

Will download the latest version of the package.

##### by name and version:

```base
packman npm download package lodash 4.17
```

##### by name, including `devDependencies` and `peerDependencies`:

```base
packman npm download package lodash --devDependencies --peerDependencies
```

#### package-lock.json

##### from local file:

```bash
packman npm download package-lock ./path/to/package-lock.json
```

##### from url:

```bash
packman npm download package-lock https://path/to/package-lock.json
```

#### package.json

##### from local file:

```bash
packman npm download package-json ./path/to/package.json
```

##### from url:

```bash
packman npm download package-json https://path/to/package.json
```

#### search keyword:

downloads the packages returned from an npm search query (https://registry.npmjs.org/-/v1/search?)

```base
packman npm download search lodash
```

Keep in mind that all of the packages returned in the search results *and their dependencies* will be downloaded.
If you're not careful, this could download a huge number of packages, which is probably not what you want.
Wield with care.

### Publish packages

Publish packages stored in a directory generated by the `npm download` command (e.g., `./tarballs`) to the current registry.

npm packages can be managed in different ways, including in standard npm registries and by universal package managers such as Nexus and Artifactory, which sometimes have their own APIs.

The third layer of commands for the `npm publish` command is named for the registry API being used, such as `npm` or `nexus`.

So there the fourth layer of `publish` sub-commands represents the modes of operation.
This will be improved in the future, to align with the three-layer principle and simplify the commands.

The `packman npm publish` command does not perform authentication.
You have to authenticate with the target registry before you run it.

#### Publish with `npm`

```bash
packman npm publish npm ./path/to/tarballs
```

Note the second `npm`!

By default, the packages will be published to the current registry.
You can publish to a different registry by using the `--registry` argument.

```bash
packman npm publish npm --registry http://localhost:4873/
```

### Copy packages

The `packman npm copy` command essentially downloads all the specified packages from a *source* registry and publishes them to a *target* registry.

* The *source* registry must be specified, except for the package-lock mode.
* The default *target* registry is always the current registry, determined by running `npm get registry`. It can be overridden by passing the `--target` argument.

For the most part, the `copy` subcommands and arguments mirror the `download` subcommands and arguments, but there are a few important differences:

* `download` uses the current registry as its source, whereas `copy` uses it as its target, by default.
* `copy` adds `--source` and `--target` arguments (as necessary)
* `copy` generates a new timestamped tarballs directory for each operation, whereas `download` always just defaults to `tarballs`

#### package name [and version]

##### by name:

```base
packman npm copy package lodash --source https://registry.npmjs.org/
```

Will download and then publish the latest version of the package.

##### by name and version:

```base
packman npm copy package lodash 4.17 --source https://registry.npmjs.org/
```

##### by name, including `devDependencies` and `peerDependencies`:

```base
packman npm copy package lodash --devDependencies --peerDependencies --source https://registry.npmjs.org/
```

#### package-lock.json

The `--source` argument is not supported for the `package-lock` command because the absolute URIs of the packages are specified in the `package-lock.json` file.

##### from local file:

```bash
packman npm copy package-lock ./path/to/package-lock.json
```

##### from url:

```bash
packman npm copy package-lock https://path/to/package-lock.json
```

#### package.json

##### from local file:

```bash
packman npm copy package-json ./path/to/package.json --source https://registry.npmjs.org/
```

##### from url:

```bash
packman npm copy package-json https://path/to/package.json --source https://registry.npmjs.org/
```

#### search keyword:

downloads the packages returned from an npm search query (https://registry.npmjs.org/-/v1/search?)

```base
packman npm copy search lodash --source https://registry.npmjs.org/
```

Keep in mind that all of the packages returned in the search results *and their dependencies* will be downloaded and then published.
If you're not careful, this could download a huge number of packages, which is probably not what you want.
It might also take a significant amount of time to publish them.
Wield with care.

# credit
Forked from [node-tgz-downloader](https://github.com/Meir017/node-tgz-downloader) and combined with other repositories by @Meir017

[npm-image]: https://img.shields.io/npm/v/@boco/packman.svg
[npm-url]: https://npmjs.org/package/@boco/packman
[downloads-image]: https://img.shields.io/npm/dm/@boco/packman.svg
[downloads-url]: https://npmjs.org/package/@boco/packman
